import mainBG from './assets/main_bg.png';
import img1 from './assets/1.png';
import img2 from './assets/2.png';
import img3 from './assets/3.png';
import img4 from './assets/4.png';
import img5 from './assets/5.png';

export const title =
  'Series SolidJS - T·∫≠p 4: Lifecycle (V√≤ng ƒë·ªùi) trong SolidJS';
export const date = '2023-02-13';
export const author = 'Pate Kem - @tunganh252';
export const desc =
  'Ch√†o c√°c b·∫°n, trong t·∫≠p n√†y T·∫≠p n√†y m√¨nh v√† c√°c b·∫°n s·∫Ω c√πng nhau t√¨m hi·ªÉu th√™m v·ªÅ 1 kh√°i ni·ªám m·ªõi l√† Lifecycle SolidJS nh√©.';
export const img = mainBG;
export const imgWidth = 1200;
export const imgHeight = 600;

## I. Gi·ªõi thi·ªáu

Hello everyone, ch√∫ng ta l·∫°i g·∫∑p nhau n·ªØa r·ªìi ‚úåÔ∏è\
T·∫≠p tr∆∞·ªõc trong series m√¨nh ƒë√£ chia s·∫ª v·ªÅ **Reactivity primitives** trong **[SolidJS](https://www.solidjs.com/)** v√† c√°ch ch√∫ng ho·∫°t ƒë·ªông.

T·∫≠p n√†y m√¨nh v√† c√°c b·∫°n s·∫Ω c√πng nhau t√¨m hi·ªÉu th√™m v·ªÅ 1 kh√°i ni·ªám m·ªõi l√† **[Lifecycle](https://www.solidjs.com/docs/latest/api#lifecycles)** trong **[SolidJS](https://www.solidjs.com/)** nh√©.

## II. N·ªôi dung

ƒê·ªãnh nghƒ©a c∆° b·∫£n v√† c√°c ph∆∞∆°ng th·ª©c trong **[Lifecycle](https://www.solidjs.com/docs/latest/api#lifecycles)**: **onMount, onCleanup v√† onError**...

---

### 1. Lifecycle trong SolidJS

Con ng∆∞·ªùi khi ƒë∆∞·ª£c sinh ra tr√™n ƒë·ªùi n√†y, ai c≈©ng ƒë·ªÅu ph·∫£i tr·∫£i qua 1 chu k·ª≥ gi·ªëng nhau: **Sinh - L√£o - B·ªánh - T·ª≠**

T·ª´ ng√†n ƒë·ªùi nay chu k·ª≥ n√†y ƒë√£ tr·ªü th√†nh m·ªôt ch√¢n l√Ω, m·ªôt ƒëi·ªÅu b·∫•t di b·∫•t d·ªãch kh√¥ng th·ªÉ thay ƒë·ªïi. Quy lu·∫≠t tr√™n kh√¥ng ch·ªâ ƒë√∫ng v·ªõi con ng∆∞·ªùi m√† ƒë√∫ng v·ªõi h·∫ßu h·∫øt m·ªçi s·ª± v·∫≠t hi·ªán t∆∞·ª£ng (**Th√†nh - Tr·ª• - Ho·∫°i - Di·ªát**)

<img src={img1} alt='img1' />
<div align='center'>
  Ngu·ªìn:<a href='https://www.istockphoto.com/'> https://www.istockphoto.com/</a>
</div>

Trong ng√†nh c√¥ng ngh·ªá c≈©ng nh∆∞ v·∫≠y, b·∫•t k·ª≥ m·ªôt c√¥ng ngh·ªá, m·ªôt ·ª©ng d·ª•ng n√†o r·ªìi c≈©ng s·∫Ω tr·∫£i qua 1 v√≤ng tu·∫ßn ho√†n nh∆∞ v·∫≠y.

N·∫øu nh∆∞ c√°c b·∫°n ƒë√£ t·ª´ng h·ªçc v·ªÅ Angular, React hay Vue... th√¨ c√≥ th·ªÉ ƒë√£ quen thu·ªôc v·ªõi thu·∫≠t ng·ªØ **Lifecycle**.

**Lifecycle** hay c√≤n g·ªçi l√† v√≤ng ƒë·ªùi, th·ªÉ hi·ªán 1 chu k·ª≥ t·ª´ l√∫c b·∫Øt ƒë·∫ßu xu·∫•t hi·ªán c·ªßa 1 **Component** ƒë·∫øn l√∫c c·∫≠p nh·∫≠t thay ƒë·ªïi tr·∫°ng th√°i, d·ªØ li·ªáu c·ªßa ch√≠nh **Component** ƒë√≥ cho ƒë·∫øn khi k·∫øt th√∫c chu k·ª≥ c·ªßa n√≥.

**Lifecycle** trong SolidJS gi·ªõi thi·ªáu ƒë·∫øn ch√∫ng ta c√°c ph∆∞∆°ng th·ª©c (methods) ho·∫°t trong c√°c chu k·ª≥ nh∆∞ **`onMount`**, **`onCleanup`** hay **`onError`**.

### 2. Ph∆∞∆°ng th·ª©c `onMount`

N·∫øu ch√∫ng ta mu·ªën th·ª±c thi 1 logic, ch·∫°y m·ªôt s·ªë ƒëo·∫°n code n√†o ƒë·∫•y ho·∫∑c ch·ªâ ƒë∆°n gi·∫£n l√† tracking th√¥ng tin, d·ªØ li·ªáu ngay l√∫c ban ƒë·∫ßu khi Component ƒë∆∞·ª£c render, ch√∫ng ta c·∫ßn s·ª≠ d·ª•ng **`onMount`**

```jsx
onMount(() => {
  console.log('I mounted!');
});
```

V·ªÅ b·∫£n ch·∫•t **`onMount()`** ƒë∆°n gi·∫£n ch·ªâ l√† g·ªçi m·ªôt h√†m **`createEffect()`** (`createEffect` ƒë√£ ƒë∆∞·ª£c m√¨nh gi·ªõi thi·ªáu ·ªü _[t·∫≠p 3 c·ªßa series](https://viblo.asia/p/series-solidjs-tap-3-reactivity-primitives-trong-solidjs-BQyJKjQW4Me)_) kh√¥ng theo d√µi b·∫•t k·ª≥ **Signals** n√†o (non-tracking). N√≥ s·∫Ω t·∫°o ra m·ªôt **Effect** v√† ch·ªâ ch·∫°y **m·ªôt l·∫ßn duy nh·∫•t** (never re-runs) sau khi Component ho√†n t·∫•t vi·ªác render l·∫ßn ƒë·∫ßu.

V√≠ d·ª• minh h·ªça:

```jsx
import { render } from 'solid-js/web';
import { createSignal, onMount } from 'solid-js';

function Info() {
  const [name, setName] = createSignal('T√πng Anh Nguy·ªÖn');

  onMount(() => {
    console.log('Mounted');
    console.log('Change name after 2 second--> Pate Kem');
    setTimeout(() => {
      setName('Pate Kem');
      console.log('Done onMount');
    }, 2000);
  });

  return <div>{name()}</div>;
}

render(() => <Info />, document.getElementById('app'));
```

> C√°c b·∫°n c√≥ th·ªÉ copy ƒëo·∫°n code tr√™n v√† paste v√†o https://playground.solidjs.com/ ƒë·ªÉ ch·∫°y vd tr·ª±c ti·∫øp nh√©.

\*Tr∆∞·ªõc khi th·ª±c thi code trong **`onMount`\***:

<img src={img2} alt='img2' />

_V√† sau khi th·ª±c thi code --> k·∫øt th√∫c qu√° tr√¨nh **`onMount`**:_

<img src={img3} alt='img3' />

V√≠ d·ª• ·ªü tr√™n nh∆∞ sau: m√¨nh kh·ªüi t·∫°o `signal` t√™n l√† `name` v·ªõi gi√° tr·ªã ban ƒë·∫ßu l√† t√™n c·ªßa m√¨nh `T√πng Anh Nguy·ªÖn`, sau khi Component `<Info/>` ƒë∆∞·ª£c render l·∫ßn ƒë·∫ßu, l√∫c ƒë·∫•y h√†m **`onMount`** s·∫Ω ƒë∆∞·ª£c trigger v√† th·ª±c thi nh·ªØng ƒëo·∫°n code b√™n trong n√≥ (m√¨nh log th√¥ng tin v√† thay ƒë·ªïi l·∫°i gi√° tr·ªã c·ªßa signal `name` th√¥ng qua h√†m `setName`)

### 3. Ph∆∞∆°ng th·ª©c `onCleanup`

khi ng∆∞·ªùi d√πng chuy·ªÉn h∆∞·ªõng ƒë·∫øn m·ªôt trang page kh√°c v√† web s·∫Ω render 1 Component m·ªõi (trang m·ªõi) thay th·∫ø cho Component (trang c≈©) ho·∫∑c khi tr√¨nh duy·ªát ƒë∆∞·ª£c ƒë√≥ng l·∫°i.

Qu√° tr√¨nh ƒë·∫•y c√≤n g·ªçi l√† **unmounting** c·ªßa Component, x·∫£y ra khi component b·ªã removed kh·ªèi m·ªôt DOM.\
L√∫c n√†y s·∫Ω c√≥ m·ªôt method ho·∫°t ƒë·ªông trong qu√° tr√¨nh n√†y l√†: **`onCleanup`**, n√≥ s·∫Ω ƒë∆∞·ª£c g·ªçi tr∆∞·ªõc khi m·ªôt Component b·ªã remove kh·ªèi m·ªôt DOM. N·∫øu m·ªôt Component kh·ªüi t·∫°o b·∫•t k√¨ m·ªôt method n√†o m√† method ƒë√≥ y√™u c·∫ßu ph·∫£i d·ªçn d·∫πp d·ªØ li·ªáu... th√¨ **`onCleanup`** s·∫Ω l√† n∆°i b·∫°n n√™n ƒë·∫∑t clean up.

N·∫øu c√°c b·∫°n ƒë√£ t·ª´ng code React Class Component th√¨ s·∫Ω bi·∫øt ƒë·∫øn ph∆∞∆°ng th·ª©c **`ComponentWillUnMount`**, c≈©ng t∆∞∆°ng t·ª± v·ªõi **`onCleanup`** trong SolidJS.

```jsx
import { render } from 'solid-js/web';
import { createSignal, onCleanup } from 'solid-js';

function App() {
  const [isToggleComponent, setIsToggleComponent] = createSignal(false);

  const handleChangeComponent = () =>
    setIsToggleComponent(!isToggleComponent());

  return (
    <div>
      <div>{isToggleComponent() ? <Info /> : <Counter />}</div>
      <button onClick={handleChangeComponent}>Change Component</button>
    </div>
  );
}

const Counter = () => {
  const [count, setCount] = createSignal(0);

  const timer = setInterval(() => setCount(count() + 1), 1000);
  onCleanup(() => {
    console.log('Cleanup: clearInterval timer...');
    clearInterval(timer);
  });

  return <p>count: {count()}</p>;
};

const Info = () => {
  const [name] = createSignal('Pate Kem');
  return <p> My name is {name()}</p>;
};

render(() => <App />, document.getElementById('app'));
```

> C√°c b·∫°n c√≥ th·ªÉ copy ƒëo·∫°n code tr√™n v√† paste v√†o https://playground.solidjs.com/ ƒë·ªÉ ch·∫°y vd tr·ª±c ti·∫øp nh√©.

·ªû v√≠ d·ª• tr√™n c√°c b·∫°n c√≥ th·ªÉ hi·ªÉu nh∆∞ sau:

- Component **`<App/>`** s·∫Ω qu·∫£n l√Ω vi·ªác hi·ªÉn th·ªã 2 Component l√† **`<Info/>`** v√† **`<Count/>`** th√¥ng qua Signal **isToggleComponent**.
- H√†m `handleChangeComponent()` gi√∫p thay ƒë·ªïi gi√° tr·ªã signal `isToggleComponent` nh·∫±m hi·ªÉn th·ªã qua l·∫°i gi·ªØa Component `<Count/>` v√† `<Info/>`.
- Component **`<Count/>`** hi·ªÉn th·ªã gi√° tr·ªã signal `count` th√¥ng qua h√†m`timer()` tr·∫£ v·ªÅ s·ªë ƒë·∫øm tƒÉng d·∫ßn +1 sau m·ªói gi√¢y.
- Sau m·ªói l·∫ßn click button `Change Component`, n·∫øu gi√° tr·ªã `isToggleComponent === true` th√¨ s·∫Ω hi·ªÉn th·ªã Component `<Info/>`, l√∫c n√†y tr∆∞·ªõc khi Component `<Counter/>` b·ªã remove kh·ªèi DOM th√¨ **`onCleanup`** s·∫Ω ƒë∆∞·ª£c th·ª±c thi v√† ti·∫øn h√†nh **`clearInterval`**.

> `clearInterval()` l√† m·ªôt h√†m trong JavaScript d√πng ƒë·ªÉ h·ªßy b·ªè m·ªôt interval (h√†nh ƒë·ªông ƒë∆∞·ª£c l·∫∑p l·∫°i sau m·ªôt kho·∫£ng th·ªùi gian nh·∫•t ƒë·ªãnh) ƒë∆∞·ª£c thi·∫øt l·∫≠p b·ªüi h√†m `setInterval()`.

### 4. Ph∆∞∆°ng th·ª©c `onError`

**`onError`** th·ª±c thi khi c√≥ l·ªói trong ph·∫°m vi c·ªßa Component ƒë√≥.

```jsx
import { render } from 'solid-js/web';
import { createSignal, onMount, onError } from 'solid-js';

function App() {
  const [isError, setIsError] = createSignal(false);

  // V√≠ d·ª• ƒë∆°n gi·∫£n ·ªü onMount m√¨nh get data v·ªÅ l·ªói ---> throw l·ªói...
  onMount(() => {
    throw new Error('Get data failed');
  });

  // onError s·∫Ω nh·∫≠n bi·∫øt c√≥ l·ªói x·∫£y ra v√† th·ª±c hi·ªán update l·∫°i signal isError
  onError(error => {
    console.log('onError: ', error);
    setIsError(true);
  });

  return (
    <div>
      <p> {isError() ? 'Error App' : 'Loading...'}</p>
    </div>
  );
}

render(() => <App />, document.getElementById('app'));
```

<img src={img4} alt='img4' />

<img src={img5} alt='img5' />

## III. T·ªïng k·∫øt t·∫≠p 4

T·∫≠p 4 n√†y ch√∫ng ta ƒë√£ c√πng t√¨m hi·ªÉu v·ªÅ c√°c kh√°i ni·ªám v√† c√°c ph∆∞∆°ng th·ª©c ch√≠nh ƒë∆∞·ª£c cung c·∫•p trong **[Lifecycle](https://www.solidjs.com/docs/latest/api#lifecycles)** c·ªßa SolidJS.

Trong t·∫≠p sau m√¨nh s·∫Ω ƒëi v√†o ph·∫ßn üïπÔ∏è **Control Flow** trong SolidJS nh√©:

- Show
- For
- Index
- Switch
- Dynamic
- Portal
- Error Boundary

C·∫£m ∆°n c√°c b·∫°n ƒë√£ theo d√µi t·∫≠p 4 trong series v·ªÅ **[SolidJS](https://www.solidjs.com/)**. N·∫øu c√°c b·∫°n c√≥ th·∫Øc m·∫Øc ho·∫∑c g√≥p √Ω v·ªÅ b√†i vi·∫øt h√£y **comment** gi√∫p m√¨nh nh√©, c·∫£m ∆°n c√°c b·∫°n üòò

### Tham kh·∫£o

https://www.solidjs.com/docs/latest/api#lifecycles
